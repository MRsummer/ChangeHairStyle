# 用户场景测试工具

## 概述

这个Go程序用于模拟多个用户并行操作你的微信小程序后端服务，测试系统的并发处理能力。

## 功能特性

- 支持100个用户并行操作
- 模拟完整的用户操作流程（登录、换发型、签到、分享等）
- 详细的统计信息（成功率、请求数、耗时等）
- 命令行参数配置
- 可选的详细日志输出

## 编译和运行

### 编译程序
```bash
go build -o test_users test_user_scenario_advanced.go
```

### 运行测试

#### 基本用法（默认100个用户）
```bash
./test_users
```

#### 指定用户数量
```bash
./test_users -users 50
```

#### 指定服务器地址
```bash
./test_users -url "http://your-server.com"
```

#### 启用详细日志
```bash
./test_users -verbose
```

#### 组合使用
```bash
./test_users -url "http://localhost:9000" -users 200 -verbose
```

## 命令行参数

- `-url`: 服务器基础URL（默认：http://localhost:9000）
- `-users`: 用户数量（默认：100）
- `-verbose`: 启用详细日志输出（默认：false）

## 测试流程

每个用户会依次执行以下操作：

1. **微信登录** - 获取用户ID
2. **换发型** - 提交发型生成请求
3. **获取记录** - 查询发型生成历史
4. **获取用户信息** - 查询用户基本信息
5. **更新用户信息** - 更新用户昵称和头像
6. **再次获取用户信息** - 验证更新结果
7. **签到** - 执行每日签到
8. **分享到广场** - 分享发型到广场
9. **获取广场内容** - 浏览广场内容
10. **点赞** - 对广场内容点赞

每个操作之间间隔1秒，模拟真实用户行为。

## 统计信息

测试完成后会显示详细的统计信息：

- 总用户数和成功/失败用户数
- 用户成功率
- 总请求数和成功/失败请求数
- 请求成功率
- 总耗时和平均耗时

## 示例输出

```
=== 用户场景测试开始 ===
基础URL: http://localhost:9000
用户数量: 100
详细模式: false
开始时间: 2024-01-15 10:30:00

=== 所有用户测试完成 ===
完成时间: 2024-01-15 10:35:30

=== 测试统计信息 ===
总用户数: 100
成功用户数: 95
失败用户数: 5
成功率: 95.00%

总请求数: 1000
成功请求数: 950
失败请求数: 50
请求成功率: 95.00%

总耗时: 5m30s
平均每个用户耗时: 3.3s
平均每个请求耗时: 330ms
```

## 注意事项

1. 确保服务器正在运行并且可以访问
2. 大量并发请求可能会对服务器造成压力，请根据服务器性能调整用户数量
3. 建议先在测试环境运行，确认无误后再在生产环境使用
4. 详细日志模式会产生大量输出，建议只在调试时使用

## 故障排除

如果遇到问题：

1. 检查服务器是否正常运行
2. 确认URL地址是否正确
3. 查看详细日志了解具体错误
4. 检查网络连接和防火墙设置 